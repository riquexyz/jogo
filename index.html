<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Trabalho de redação</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .leaderboard-buttons button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
    }

    #nome-input {
      background-color: rgba(0, 0, 0, 0.9);
      padding: 30px;
      border-radius: 10px;
      text-align: center;
    }

    #nome-input h2 {
      color: white;
      margin-bottom: 20px;
    }

    #player-name {
      padding: 10px;
      font-size: 18px;
      width: 250px;
      margin-bottom: 20px;
      border: 2px solid #4CAF50;
      border-radius: 5px;
      background-color: rgba(255, 255, 255, 0.9);
    }

    #btn-continuar-nome {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
    }

    #btn-continuar-nome:hover {
      background-color: #45a049;
    }

    /* Estilos para o leaderboard */
    #leaderboard table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
    }

    #leaderboard th,
    #leaderboard td {
      padding: 15px 30px;
      text-align: center;
    }

    #leaderboard th {
      background-color: rgba(76, 175, 80, 0.2);
      color: white;
      font-size: 18px;
    }

    #leaderboard td {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 16px;
    }

    /* Definindo larguras específicas para cada coluna */
    #leaderboard th:nth-child(1),
    #leaderboard td:nth-child(1) {
      width: 15%;
    }

    #leaderboard th:nth-child(2),
    #leaderboard td:nth-child(2) {
      width: 35%;
    }

    #leaderboard th:nth-child(3),
    #leaderboard td:nth-child(3) {
      width: 25%;
    }

    #leaderboard th:nth-child(4),
    #leaderboard td:nth-child(4) {
      width: 25%;
    }

    #jumpscare-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 0.1s;
    }

    #jumpscare-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #jumpscare-video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    #btn-sair-fullscreen {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      z-index: 1000;
      display: none;
    }

    #btn-sair-fullscreen:hover {
      background-color: #45a049;
    }

    #bg-blur, #bg-sala {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
      transition: opacity 0.5s ease;
    }
    .hidden {
      opacity: 0;
      pointer-events: none;
    }
    .visible {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <!-- Fundo de um corredor borrado -->
  <img id="bg-blur" class="visible" src="https://cdn.discordapp.com/attachments/1236458611514015795/1369384676392698027/Imagem_do_WhatsApp_de_2025-05-06_as_14.15.28_6544a1a8.jpg?ex=681baa5c&is=681a58dc&hm=642a805312a2f9d53c32a67bf9613b1c5015f8dd758dcd550a6183e42ac3f1b0&" alt="corredor borrado" />
  <!-- Fundo da sala de aula para seleção de personagem -->
  <img id="bg-sala" class="hidden" src="https://th.bing.com/th/id/R.b046c3cc2d661db2f3be34531362cc26?rik=j5ZtWwLO9Ym9zQ&pid=ImgRaw&r=0" alt="sala de aula" />

  <!-- Botão de créditos no topo direito -->
  <button id="btn-creditos" class="top-right">Créditos</button>
 
  <!-- Botão dinâmico no topo esquerdo -->
  <button id="btn-top-left" class="top-left">Leaderboard</button>
   
  <!-- Menu principal centralizado -->
  <div id="menu" class="centered">
    <button id="btn-jogar">Jogar</button>
  </div>

  <!-- Tela de input do nome -->
  <div id="nome-input" class="centered hidden">
    <h2>Digite seu nome</h2>
    <input type="text" id="player-name" placeholder="Seu nome" maxlength="20">
    <button id="btn-continuar-nome">Continuar</button>
  </div>

  <!-- Tela de seleção de habilidade -->
  <div id="personagem" class="centered hidden">
    <h2>Escolha sua habilidade</h2>
    <div class="personagens-container">
      <div class="personagem-card" data-nome="Eliminar Alternativas" data-habilidade="Você ira poder eliminar 2 alternativas erradas.">
        <img src="https://th.bing.com/th/id/OIP.eXWTKjmehn9Cvh-AcnHEkAHaHa?rs=1&pid=ImgDetMain" alt="Eliminar Alternativas">
        <div class="nome-personagem">Eliminar Alternativas</div>
        <div class="habilidade-dialogo"></div>
        <button class="btn-continuar hidden">Continuar</button>
      </div>
      <div class="personagem-card" data-nome="Ver Dicas" data-habilidade="Você tera as dicas das respostas.">
        <img src="https://img.freepik.com/vetores-premium/ilustracao-de-uma-lampada-em-um-fundo-transparente_841845-148.jpg" alt="Ver Dicas">
        <div class="nome-personagem">Ver Dicas</div>
        <div class="habilidade-dialogo"></div>
        <button class="btn-continuar hidden">Continuar</button>
      </div>
      <div class="personagem-card" data-nome="Reduzir Tempo" data-habilidade="Você ira conseguir o tempo total.">
        <img src="https://static.vecteezy.com/ti/vetor-gratis/p3/14669389-icone-de-ampulheta-estilo-cartoon-vetor.jpg" alt="Reduzir Tempo">
        <div class="nome-personagem">Reduzir Tempo</div>
        <div class="habilidade-dialogo"></div>
        <button class="btn-continuar hidden">Continuar</button>
      </div>
      <div class="personagem-card" data-nome="Segunda Chance" data-habilidade="Se você errar a questão você poderá responder ela novamente.">
        <img src="https://cdn.discordapp.com/attachments/1369109409132843100/1369138923405574164/Totem_of_Undying_JE2_BE2.png?ex=681ac57c&is=681973fc&hm=2a4b2848d08a7b81348b037a99c77691047537e778fef5eb41039961c81fa6a4&" alt="Segunda Chance">
        <div class="nome-personagem">Segunda Chance</div>
        <div class="habilidade-dialogo"></div>
        <button class="btn-continuar hidden">Continuar</button>
      </div>
      <div class="personagem-card" data-nome="Multiplicador" data-habilidade="Você ira poder multiplicar os pontos por 2 durante 10 segundos.">
        <img src="https://th.bing.com/th/id/OIP.FqVjgXwhzq-mSvQOIC99lAAAAA?rs=1&pid=ImgDetMain" alt="Multiplicador">
        <div class="nome-personagem">Multiplicador</div>
        <div class="habilidade-dialogo"></div>
        <button class="btn-continuar hidden">Continuar</button>
      </div>
    </div>
  </div>

  <!-- Tela do jogo -->
  <div id="game" class="centered hidden">
    <h2>Jogo: Conotação vs Denotação</h2>
    <div id="personagem-escolhido"></div>
    <div id="info-jogo">
      <div id="pontuacao">Pontuação: 0</div>
      <div id="tempo-decorrido">Tempo: 0s</div>
    </div>
    <div id="botoes-respostas">
      <button id="btn-conotacao">Conotação</button>
      <button id="btn-denotacao">Denotação</button>
      <button id="btn-metafora">Metáfora</button>
      <button id="btn-hiperbole">Hipérbole</button>
    </div>
    <div id="pergunta"></div>
    <button id="btn-habilidade" class="hidden">Usar Habilidade</button>
  </div>

  <div id="creditos" class="centered hidden">
    <h2>Créditos</h2>
    <div id="creditos-content" style="text-align:left">
      <p>• Jogo Criado e programado por Henrique<br>
      • Design gráfico por Agatha<br>
      • Ideia e ajuda da Sheley</p>
    </div>
    <button id="btn-voltar-creditos">Voltar ao Menu</button>
  </div>

  <!-- Tela de leaderboard -->
  <div id="leaderboard" class="centered hidden">
    <h2>Leaderboard</h2>
    <div id="leaderboard-content">
      <table>
        <thead>
          <tr>
            <th>Posição</th>
            <th>Nome</th>
            <th>Pontuação</th>
            <th>Tempo</th>
          </tr>
        </thead>
        <tbody id="leaderboard-body">
        </tbody>
      </table>
    </div>
    <div class="leaderboard-buttons">
      <button id="btn-voltar-leaderboard">Voltar ao Menu</button>
      <button id="btn-reset-leaderboard" class="reset-button">Resetar Leaderboard</button>
    </div>
  </div>

  <!-- Tela de resultados -->
  <div id="resultados" class="centered hidden">
    <h2>Resultados</h2>
    <div id="resultados-content">
      <p>Pontuação final: <span id="pontuacao-final">0</span></p>
      <p>Tempo total: <span id="tempo-total">0</span> segundos</p>
      <button id="btn-jogar-novamente">Jogar Novamente</button>
    </div>
  </div>

  <!-- Áudios para feedback sonoro -->
  <audio id="som-correto" src="https://cdn.discordapp.com/attachments/1236458611514015795/1369397333329973248/duolingo-correct.mp3?ex=681bb626&is=681a64a6&hm=a4c33d6dff8602029875de28813099d7a1d9d6d2b717184e7ce8c725a51bef70&" preload="auto"></audio>
  <audio id="som-erro" src="https://cdn.discordapp.com/attachments/1236458611514015795/1369397528939991141/duolingo-wrong.mp3?ex=681bb655&is=681a64d5&hm=8864fe341310bb1f483a364ccdc6fb6f30cdf135556c7a37370846588bcae931&" preload="auto"></audio>
  <audio id="som-jumpscare" src="https://cdn.discordapp.com/attachments/1236458611514015795/1369397528939991141/duolingo-wrong.mp3?ex=681bb655&is=681a64d5&hm=8864fe341310bb1f483a364ccdc6fb6f30cdf135556c7a37370846588bcae931&" preload="auto"></audio>

  <!-- Jumpscare overlay -->
  <div id="jumpscare-overlay" class="hidden">
    <video id="jumpscare-video" width="100%" height="100%" autoplay>
      <source src="https://cdn.discordapp.com/attachments/1236458611514015795/1369416174474887279/video.mp4?ex=681bc7b2&is=681a7632&hm=a0836a9766706f39197f5de1b3ae70dd36205a38b5a0130c2d228026a6ddc836&" type="video/mp4">
    </video>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      // Substitua com suas configurações do Firebase
      apiKey: "AIzaSyARaZW4VeK9hQIuKh_na731tqQWk314bK0",
      authDomain: "jogo-conotacao.firebaseapp.com",
      databaseURL: "https://jogo-conotacao-default-rtdb.firebaseio.com",
      projectId: "jogo-conotacao",
      storageBucket: "jogo-conotacao.firebasestorage.app",
      messagingSenderId: "551283073662",
      appId: "1:551283073662:web:a8d274b8532e7e84472e2f"
    };

    // Inicializa o Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Botões principais
    const btnCreditos = document.getElementById('btn-creditos');
    const btnVoltarCreditos = document.getElementById('btn-voltar-creditos');
    const creditos = document.getElementById('creditos');
    const menu = document.getElementById('menu');
    const btnJogar = document.getElementById('btn-jogar');
    const personagem = document.getElementById('personagem');
    const btnLeaderboard = document.getElementById('btn-top-left');
    const game = document.getElementById('game');
    const btnSairJogo = document.getElementById('btn-sair-jogo');
    const personagemEscolhidoDiv = document.getElementById('personagem-escolhido');
    const perguntaDiv = document.getElementById('pergunta');
    const pontuacaoDiv = document.getElementById('pontuacao');
    const btnHabilidade = document.getElementById('btn-habilidade');

    // Botões de resposta
    const btnConotacao = document.getElementById('btn-conotacao');
    const btnDenotacao = document.getElementById('btn-denotacao');
    const btnMetafora = document.getElementById('btn-metafora');
    const btnHiperbole = document.getElementById('btn-hiperbole');

    let personagemEscolhido = null;
    let pontuacao = 0;
    let perguntaAtual = null;
    let habilidadeUsada = false;
    let multiplicadorAtivo = false;
    let tempoHabilidade = null;
    let tempoInicio = null;
    let tempoTotal = 0;
    let timerInterval = null;
    let usosHabilidade = 5; // Contador de usos da habilidade
    let playerName = '';
    let acertos = 0; // Contador de acertos
    let errosConsecutivos = 0; // Contador de erros consecutivos
    const CHANCE_BASE_JUMPSCARE = 0.01; // 1% de chance base
    const AUMENTO_CHANCE_POR_ERRO = 0.05; // Aumenta 5% por erro
    let jumpscareJaApareceu = false; // Flag para controlar se o jumpscare já apareceu

    // Array de perguntas
    const perguntas = [
      {
        texto: "O tempo é um rio que corre sem parar.",
        resposta: "metafora",
        explicacao: "Compara o tempo com um rio, sugerindo que ambos fluem continuamente.",
        dica: "Pense em uma comparação entre dois elementos diferentes."
      },
      {
        texto: "O sol nasceu no horizonte.",
        resposta: "denotacao",
        explicacao: "Descreve um fato literal, sem sentido figurado.",
        dica: "É uma descrição direta e objetiva."
      },
      {
        texto: "Ela tem um coração de pedra.",
        resposta: "metafora",
        explicacao: "Compara a dureza do coração com a dureza da pedra.",
        dica: "Compara características humanas com elementos da natureza."
      },
      {
        texto: "Estou morrendo de fome!",
        resposta: "hiperbole",
        explicacao: "Exagera a sensação de fome para dar ênfase.",
        dica: "É um exagero para expressar intensidade."
      },
      {
        texto: "Aquele menino é um gato.",
        resposta: "conotacao",
        explicacao: "Usa 'gato' no sentido de pessoa bonita, não no sentido literal.",
        dica: "A palavra tem um significado diferente do usual."
      },
      {
        texto: "Choveu tanto que alagou a cidade inteira.",
        resposta: "hiperbole",
        explicacao: "Exagera a quantidade de chuva para dar ênfase.",
        dica: "É um exagero para expressar intensidade."
      },
      {
        texto: "O céu está azul hoje.",
        resposta: "denotacao",
        explicacao: "Descreve um fato literal, sem sentido figurado.",
        dica: "É uma descrição direta e objetiva."
      },
      {
        texto: "Ele é um leão na defesa.",
        resposta: "metafora",
        explicacao: "Compara a bravura na defesa com a força de um leão.",
        dica: "Compara características humanas com animais."
      },
      {
        texto: "Aquele lugar é um forno.",
        resposta: "conotacao",
        explicacao: "Usa 'forno' no sentido de lugar muito quente, não no sentido literal.",
        dica: "A palavra tem um significado diferente do usual."
      },
      {
        texto: "Estou há séculos esperando por você!",
        resposta: "hiperbole",
        explicacao: "Exagera o tempo de espera para dar ênfase.",
        dica: "É um exagero para expressar intensidade."
      },
      {
        texto: "A vida é uma caixa de surpresas.",
        resposta: "metafora",
        explicacao: "Compara a vida com uma caixa de surpresas, sugerindo imprevisibilidade.",
        dica: "Compara a vida com um objeto."
      },
      {
        texto: "O livro está sobre a mesa.",
        resposta: "denotacao",
        explicacao: "Descreve um fato literal, sem sentido figurado.",
        dica: "É uma descrição direta e objetiva."
      },
      {
        texto: "Ele é um gênio da matemática.",
        resposta: "conotacao",
        explicacao: "Usa 'gênio' no sentido de pessoa muito inteligente, não no sentido literal.",
        dica: "A palavra tem um significado diferente do usual."
      },
      {
        texto: "Meu coração está partido em mil pedaços.",
        resposta: "hiperbole",
        explicacao: "Exagera o sentimento de tristeza para dar ênfase.",
        dica: "É um exagero para expressar intensidade."
      },
      {
        texto: "O vento sussurrava nas folhas.",
        resposta: "metafora",
        explicacao: "Compara o som do vento com um sussurro.",
        dica: "Compara um fenômeno natural com uma ação humana."
      },
      {
        texto: "A água está gelada.",
        resposta: "denotacao",
        explicacao: "Descreve um fato literal, sem sentido figurado.",
        dica: "É uma descrição direta e objetiva."
      },
      {
        texto: "Ela é uma flor no jardim da vida.",
        resposta: "metafora",
        explicacao: "Compara a pessoa com uma flor, sugerindo beleza e delicadeza.",
        dica: "Compara uma pessoa com um elemento da natureza."
      },
      {
        texto: "Estou com um sono de urso!",
        resposta: "hiperbole",
        explicacao: "Exagera a sensação de sono para dar ênfase.",
        dica: "É um exagero para expressar intensidade."
      },
      {
        texto: "Aquele rapaz é um peixe.",
        resposta: "conotacao",
        explicacao: "Usa 'peixe' no sentido de pessoa que nada bem, não no sentido literal.",
        dica: "A palavra tem um significado diferente do usual."
      },
      {
        texto: "A lua é um farol no céu.",
        resposta: "metafora",
        explicacao: "Compara a lua com um farol, sugerindo que ilumina o céu.",
        dica: "Compara um astro com um objeto que ilumina."
      },
      {
        texto: "A árvore tem folhas verdes.",
        resposta: "denotacao",
        explicacao: "Descreve um fato literal, sem sentido figurado.",
        dica: "É uma descrição direta e objetiva."
      },
      {
        texto: "Ele tem um coração de ouro.",
        resposta: "metafora",
        explicacao: "Compara a bondade do coração com o valor do ouro.",
        dica: "Compara características humanas com metais preciosos."
      },
      {
        texto: "Estou com uma fome de leão!",
        resposta: "hiperbole",
        explicacao: "Exagera a sensação de fome para dar ênfase.",
        dica: "É um exagero para expressar intensidade."
      },
      {
        texto: "Aquele lugar é um paraíso.",
        resposta: "conotacao",
        explicacao: "Usa 'paraíso' no sentido de lugar muito bonito, não no sentido literal.",
        dica: "A palavra tem um significado diferente do usual."
      },
      {
        texto: "O mar está calmo hoje.",
        resposta: "denotacao",
        explicacao: "Descreve um fato literal, sem sentido figurado.",
        dica: "É uma descrição direta e objetiva."
      }
    ];

    // Função para formatar o tempo
    function formatarTempo(segundos) {
      const minutos = Math.floor(segundos / 60);
      const segundosRestantes = Math.floor(segundos % 60);
      return `${minutos}:${segundosRestantes.toString().padStart(2, '0')}`;
    }

    // Array para armazenar as melhores pontuações
    let melhoresPontuacoes = [];

    // Função para carregar o leaderboard do Firebase
    async function carregarLeaderboard() {
      try {
        const snapshot = await database.ref('leaderboard').once('value');
        melhoresPontuacoes = snapshot.val() || [];
        atualizarTabelaLeaderboard();
      } catch (error) {
        console.error('Erro ao carregar leaderboard:', error);
      }
    }

    // Função para salvar nova pontuação no Firebase
    async function salvarPontuacao(pontuacao, tempo) {
      try {
        const novaPontuacao = {
          nome: playerName,
          pontuacao,
          tempo,
          data: new Date().toISOString()
        };
        
        // Verifica se o jogador já existe no leaderboard
        const indexJogadorExistente = melhoresPontuacoes.findIndex(score => score.nome === playerName);
        
        if (indexJogadorExistente !== -1) {
          // Se o jogador já existe, atualiza apenas se a nova pontuação for maior
          if (pontuacao > melhoresPontuacoes[indexJogadorExistente].pontuacao) {
            melhoresPontuacoes[indexJogadorExistente] = novaPontuacao;
          }
        } else {
          // Se o jogador não existe, adiciona a nova pontuação
          melhoresPontuacoes.push(novaPontuacao);
        }
        
        // Ordena por pontuação (maior primeiro) e tempo (menor primeiro)
        melhoresPontuacoes.sort((a, b) => {
          if (b.pontuacao !== a.pontuacao) {
            return b.pontuacao - a.pontuacao;
          }
          return a.tempo - b.tempo;
        });
        
        // Mantém apenas as 10 melhores pontuações
        melhoresPontuacoes = melhoresPontuacoes.slice(0, 10);
        
        // Salva no Firebase
        await database.ref('leaderboard').set(melhoresPontuacoes);
        
        // Atualiza a tabela
        atualizarTabelaLeaderboard();
      } catch (error) {
        console.error('Erro ao salvar pontuação:', error);
      }
    }

    // Função para atualizar a tabela do leaderboard
    function atualizarTabelaLeaderboard() {
      leaderboardBody.innerHTML = '';
      melhoresPontuacoes.forEach((score, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}º</td>
          <td>${score.nome}</td>
          <td>${score.pontuacao}/25</td>
          <td>${formatarTempo(score.tempo)}s</td>
        `;
        leaderboardBody.appendChild(row);
      });
    }

    // Função para mostrar resultados
    function mostrarResultados() {
      const resultados = document.getElementById('resultados');
      const pontuacaoFinal = document.getElementById('pontuacao-final');
      const tempoTotalSpan = document.getElementById('tempo-total');
      
      tempoTotal = (Date.now() - tempoInicio) / 1000;
      
      // Aplica a habilidade do Rafa (reduz o tempo em 20%)
      if (personagemEscolhido.nome === 'Reduzir Tempo') {
        tempoTotal = tempoTotal * 0.8; // Reduz 20% do tempo
      }
      
      pontuacaoFinal.textContent = `${acertos}/25`;
      tempoTotalSpan.textContent = formatarTempo(tempoTotal);
      
      // Salva a pontuação no Firebase
      salvarPontuacao(acertos, tempoTotal);
      
      // Esconde o jogo e mostra o leaderboard
      game.classList.add('hidden');
      leaderboard.classList.remove('hidden');
      atualizarTabelaLeaderboard();
    }

    // Função para atualizar o contador de usos
    function atualizarContadorUsos() {
      const contadorUsos = document.getElementById('contador-usos');
      if (contadorUsos) {
        contadorUsos.textContent = `Usos restantes: ${usosHabilidade}`;
      }
    }

    // Função para mostrar uma nova pergunta
    function mostrarNovaPergunta() {
      perguntaAtual = sortearPergunta();
      if (!perguntaAtual) {
        mostrarResultados();
        return;
      }
      
      perguntaDiv.innerHTML = `
        <div class="texto-pergunta">${perguntaAtual.texto}</div>
        <div class="explicacao hidden">${perguntaAtual.explicacao}</div>
        ${personagemEscolhido.nome === 'Ver Dicas' ? `<div class="dica hidden">Dica: ${perguntaAtual.dica}</div>` : ''}
      `;
      
      // Reset botões
      document.querySelectorAll('#botoes-respostas button').forEach(btn => {
        btn.disabled = false;
        btn.style.opacity = '1';
      });

      // Reset habilidade
      habilidadeUsada = false;
      
      // Mostra o botão de habilidade baseado no personagem
      if (personagemEscolhido.nome === 'Eliminar Alternativas' && podeUsarHabilidade()) {
        btnHabilidade.classList.remove('hidden');
        btnHabilidade.textContent = 'Usar Habilidade';
      } else if (personagemEscolhido.nome === 'Multiplicador' && !multiplicadorAtivo && podeUsarHabilidade()) {
        btnHabilidade.classList.remove('hidden');
        btnHabilidade.textContent = 'Ativar Multiplicador';
      } else if (personagemEscolhido.nome === 'Segunda Chance' && podeUsarHabilidade()) {
        btnHabilidade.classList.add('hidden'); // Começa escondido para a Segunda Chance
      } else if (personagemEscolhido.nome === 'Ver Dicas' && podeUsarHabilidade()) {
        btnHabilidade.classList.remove('hidden');
        btnHabilidade.textContent = 'Ver Dica';
      } else if (personagemEscolhido.nome === 'Reduzir Tempo' && podeUsarHabilidade()) {
        btnHabilidade.classList.remove('hidden');
        btnHabilidade.textContent = 'Reduzir Tempo';
      } else {
        btnHabilidade.classList.add('hidden');
      }
    }

    // Função para sortear uma nova pergunta
    function sortearPergunta() {
      const perguntasNaoUsadas = perguntas.filter(p => !p.usada);
      if (perguntasNaoUsadas.length === 0) {
        mostrarResultados();
        return null;
      }
      
      const pergunta = perguntasNaoUsadas[Math.floor(Math.random() * perguntasNaoUsadas.length)];
      pergunta.usada = true;
      return pergunta;
    }

    // Função para verificar se pode usar a habilidade
    function podeUsarHabilidade() {
      return usosHabilidade > 0;
    }

    // Função para usar a habilidade
    function usarHabilidade() {
      if (podeUsarHabilidade()) {
        usosHabilidade--;
        atualizarContadorUsos();
        return true;
      }
      return false;
    }

    // Função para atualizar o tempo decorrido
    function atualizarTempoDecorrido() {
      const tempoDecorrido = document.getElementById('tempo-decorrido');
      if (tempoDecorrido) {
        const tempoAtual = (Date.now() - tempoInicio) / 1000;
        tempoDecorrido.textContent = `Tempo: ${formatarTempo(tempoAtual)}`;
      }
    }

    // Função para resetar o jogo
    function resetarJogo() {
      // Reset das perguntas
      perguntas.forEach(p => p.usada = false);
      
      // Reset da pontuação e habilidades
      pontuacao = 0;
      acertos = 0;
      multiplicadorAtivo = false;
      usosHabilidade = 5;
      errosConsecutivos = 0;
      jumpscareJaApareceu = false; // Reseta o flag do jumpscare
      if (tempoHabilidade) {
        clearTimeout(tempoHabilidade);
      }
      if (timerInterval) {
        clearInterval(timerInterval);
      }
      pontuacaoDiv.textContent = `Pontuação: ${acertos}`;
      atualizarContadorUsos();
    }

    // Função para eliminar alternativas
    function eliminarAlternativas() {
      if (personagemEscolhido.nome === 'Eliminar Alternativas' && !habilidadeUsada && podeUsarHabilidade()) {
        if (usarHabilidade()) {
          const respostas = ['conotacao', 'denotacao', 'metafora', 'hiperbole'];
          const respostasErradas = respostas.filter(r => r !== perguntaAtual.resposta);
          
          const eliminadas = [];
          while (eliminadas.length < 2) {
            const index = Math.floor(Math.random() * respostasErradas.length);
            const resposta = respostasErradas[index];
            if (!eliminadas.includes(resposta)) {
              eliminadas.push(resposta);
              document.getElementById(`btn-${resposta}`).style.opacity = '0.3';
              document.getElementById(`btn-${resposta}`).disabled = true;
            }
          }
          habilidadeUsada = true;
          btnHabilidade.classList.add('hidden');
        }
      }
    }

    // Função para ativar o multiplicador de pontos
    function ativarMultiplicador() {
      if (personagemEscolhido.nome === 'Multiplicador' && !multiplicadorAtivo && podeUsarHabilidade()) {
        if (usarHabilidade()) {
          multiplicadorAtivo = true;
          btnHabilidade.classList.add('hidden');
          btnHabilidade.textContent = 'Multiplicador Ativo';
          
          // Mostra mensagem de habilidade ativada
          const mensagemHabilidade = document.createElement('div');
          mensagemHabilidade.id = 'mensagem-habilidade';
          mensagemHabilidade.textContent = 'Multiplicador de Pontos Ativo!';
          document.body.appendChild(mensagemHabilidade);
          
          setTimeout(() => {
            mensagemHabilidade.remove();
          }, 2000);
          
          tempoHabilidade = setTimeout(() => {
            multiplicadorAtivo = false;
            const mensagemFim = document.createElement('div');
            mensagemFim.id = 'mensagem-habilidade';
            mensagemFim.textContent = 'Multiplicador Desativado!';
            document.body.appendChild(mensagemFim);
            
            setTimeout(() => {
              mensagemFim.remove();
            }, 2000);
          }, 10000);
        }
      }
    }

    // Função para ativar a redução de tempo do Rafa
    function ativarReducaoTempo() {
      if (personagemEscolhido.nome === 'Reduzir Tempo' && !habilidadeUsada && podeUsarHabilidade()) {
        if (usarHabilidade()) {
          // Reduz exatamente 20 segundos do tempo atual
          const tempoAtual = (Date.now() - tempoInicio) / 1000;
          tempoInicio = Date.now() - ((tempoAtual - 20) * 1000);
          
          // Mostra mensagem de habilidade ativada
          const mensagemHabilidade = document.createElement('div');
          mensagemHabilidade.id = 'mensagem-habilidade';
          mensagemHabilidade.textContent = 'Tempo Reduzido em 20 segundos!';
          document.body.appendChild(mensagemHabilidade);
          
          setTimeout(() => {
            mensagemHabilidade.remove();
          }, 2000);
          
          habilidadeUsada = true;
          btnHabilidade.classList.add('hidden');
        }
      }
    }

    // Função para mostrar o jumpscare
    function mostrarJumpscare() {
      const overlay = document.getElementById('jumpscare-overlay');
      const video = document.getElementById('jumpscare-video');
      const somJumpscare = document.getElementById('som-jumpscare');
      
      overlay.classList.remove('hidden');
      video.currentTime = 0;
      video.play();
      somJumpscare.currentTime = 0;
      somJumpscare.play();
      
      // Esconde o jumpscare após 15 segundos
      setTimeout(() => {
        overlay.classList.add('hidden');
        video.pause();
      }, 2000);
    }

    // Função para verificar a resposta
    function verificarResposta(resposta) {
      const explicacao = perguntaDiv.querySelector('.explicacao');
      explicacao.classList.remove('hidden');
      
      // Elementos de áudio
      const somCorreto = document.getElementById('som-correto');
      const somErro = document.getElementById('som-erro');
      
      if (resposta === perguntaAtual.resposta) {
        // Toca som de acerto
        somCorreto.currentTime = 0;
        somCorreto.play();
        
        // Reseta o contador de erros consecutivos
        errosConsecutivos = 0;
        
        // Incrementa o contador de acertos
        acertos++;
        
        // Aplica o multiplicador se estiver ativo
        const pontosGanhos = multiplicadorAtivo ? 2 : 1;
        pontuacao += pontosGanhos;
        pontuacaoDiv.textContent = `Pontuação: ${acertos}`;
        
        // Mostra mensagem de pontos multiplicados
        if (multiplicadorAtivo) {
          const mensagemPontos = document.createElement('div');
          mensagemPontos.id = 'mensagem-pontos';
          mensagemPontos.textContent = `+${pontosGanhos} pontos!`;
          document.body.appendChild(mensagemPontos);
          
          setTimeout(() => {
            mensagemPontos.remove();
          }, 1500);
        }
        
        // Adiciona mensagem de acerto na explicação
        explicacao.innerHTML = `<div style="color: #4CAF50; font-weight: bold; margin-bottom: 10px;">✓ Resposta Correta!</div>${perguntaAtual.explicacao}`;
        
        setTimeout(() => {
          explicacao.classList.add('hidden');
          mostrarNovaPergunta();
        }, 2500);
      } else {
        // Toca som de erro
        somErro.currentTime = 0;
        somErro.play();
        
        // Incrementa o contador de erros consecutivos
        errosConsecutivos++;
        
        // Calcula a chance do jumpscare apenas se ainda não apareceu
        if (!jumpscareJaApareceu) {
          const chanceJumpscare = CHANCE_BASE_JUMPSCARE + (errosConsecutivos * AUMENTO_CHANCE_POR_ERRO);
          
          // Verifica se o jumpscare deve aparecer
          if (Math.random() < chanceJumpscare) {
            mostrarJumpscare();
            jumpscareJaApareceu = true; // Marca que o jumpscare já apareceu
          }
        }
        
        // Adiciona mensagem de erro na explicação
        explicacao.innerHTML = `<div style="color: #f44336; font-weight: bold; margin-bottom: 10px;">✗ Resposta Incorreta!</div>${perguntaAtual.explicacao}`;
        
        // Se for a Segunda Chance, mostra o botão de habilidade
        if (personagemEscolhido.nome === 'Segunda Chance' && !habilidadeUsada && podeUsarHabilidade()) {
          btnHabilidade.classList.remove('hidden');
          btnHabilidade.textContent = 'Tentar Novamente';
        } else {
          setTimeout(() => {
            explicacao.classList.add('hidden');
            mostrarNovaPergunta();
          }, 2500);
        }
      }
    }

    // Event listener para os botões de resposta
    btnConotacao.onclick = () => verificarResposta('conotacao');
    btnDenotacao.onclick = () => verificarResposta('denotacao');
    btnMetafora.onclick = () => verificarResposta('metafora');
    btnHiperbole.onclick = () => verificarResposta('hiperbole');

    // Event listener para o botão de habilidade
    btnHabilidade.onclick = () => {
      if (personagemEscolhido.nome === 'Eliminar Alternativas') {
        eliminarAlternativas();
      } else if (personagemEscolhido.nome === 'Segunda Chance' && !habilidadeUsada && podeUsarHabilidade()) {
        if (usarHabilidade()) {
          // Esconde a explicação e permite tentar novamente
          const explicacao = perguntaDiv.querySelector('.explicacao');
          explicacao.classList.add('hidden');
          btnHabilidade.classList.add('hidden');
          habilidadeUsada = true;
          
          // Reativa os botões de resposta
          document.querySelectorAll('#botoes-respostas button').forEach(btn => {
            btn.disabled = false;
            btn.style.opacity = '1';
          });
        }
      } else if (personagemEscolhido.nome === 'Multiplicador') {
        ativarMultiplicador();
      } else if (personagemEscolhido.nome === 'Ver Dicas' && podeUsarHabilidade()) {
        if (usarHabilidade()) {
          // Mostra a dica
          const dica = perguntaDiv.querySelector('.dica');
          dica.classList.remove('hidden');
          btnHabilidade.classList.add('hidden');
          habilidadeUsada = true;
        }
      } else if (personagemEscolhido.nome === 'Reduzir Tempo') {
        ativarReducaoTempo();
      }
    };

    // Seleção de habilidade: balão sobreposto e continuar
    document.querySelectorAll('.personagem-card').forEach(card => {
      const dialogo = card.querySelector('.habilidade-dialogo');
      const btnContinuar = card.querySelector('.btn-continuar');

      function abrirDialogo() {
        // Fecha balões e botões de todos os outros personagens antes
        document.querySelectorAll('.personagem-card').forEach(outro => {
          if (outro !== card) {
            outro.classList.remove('selecionado');
            outro.querySelector('.habilidade-dialogo').textContent = '';
            outro.querySelector('.habilidade-dialogo').style.opacity = 0;
            outro.querySelector('.btn-continuar').classList.add('hidden');
          }
        });
        dialogo.textContent = card.dataset.habilidade;
        dialogo.style.opacity = 1;
        card.classList.add('selecionado');
        btnContinuar.classList.remove('hidden');
        // Garante que está acima de todas as opções
        dialogo.style.zIndex = 30;
      }

      function fecharDialogo() {
        if (!card.classList.contains('selecionado')) {
          dialogo.textContent = '';
          dialogo.style.opacity = 0;
          btnContinuar.classList.add('hidden');
        }
      }

      card.addEventListener('mouseenter', abrirDialogo);
      card.addEventListener('mouseleave', fecharDialogo);
      card.addEventListener('focus', abrirDialogo);
      card.addEventListener('blur', fecharDialogo);
      card.addEventListener('click', abrirDialogo);
      card.addEventListener('keypress', (e) => {
        if (e.key === "Enter" || e.key === " ") {
          abrirDialogo();
        }
      });

      btnContinuar.addEventListener('click', () => {
        // Define a habilidade escolhida
        personagemEscolhido = {
          nome: card.dataset.nome,
          habilidade: card.dataset.habilidade,
          img: card.querySelector('img').src
        };
        
        // Esconde a tela de habilidade e mostra o jogo
        personagem.classList.add('hidden');
        game.classList.remove('hidden');
        
        // Inicializa o jogo
        mostrarPersonagemEscolhido();
        resetarJogo();
        tempoInicio = Date.now();
        
        // Inicia o timer
        timerInterval = setInterval(atualizarTempoDecorrido, 100);
        
        // Adiciona o contador de usos junto com o botão de habilidade
        const containerHabilidade = document.createElement('div');
        containerHabilidade.id = 'container-habilidade';
        
        const contadorUsos = document.createElement('div');
        contadorUsos.id = 'contador-usos';
        contadorUsos.textContent = `Usos restantes: ${usosHabilidade}`;
        
        containerHabilidade.appendChild(btnHabilidade);
        containerHabilidade.appendChild(contadorUsos);
        game.appendChild(containerHabilidade);
        
        // Mostra a primeira pergunta
        mostrarNovaPergunta();
        
        // Limpa seleção visual para próxima vez
        document.querySelectorAll('.personagem-card').forEach(card => {
          card.classList.remove('selecionado');
          card.querySelector('.habilidade-dialogo').textContent = '';
          card.querySelector('.habilidade-dialogo').style.opacity = 0;
          card.querySelector('.btn-continuar').classList.add('hidden');
        });
      });
    });

    function mostrarPersonagemEscolhido() {
      if (personagemEscolhido) {
        personagemEscolhidoDiv.innerHTML = `
          <div class="mini-personagem">
            <img src="${personagemEscolhido.img}" alt="${personagemEscolhido.nome}">
            <span>${personagemEscolhido.nome}</span>
            <div class="mini-habilidade">${personagemEscolhido.habilidade}</div>
          </div>
        `;
      }
    }

    const leaderboard = document.getElementById('leaderboard');
    const btnVoltarLeaderboard = document.getElementById('btn-voltar-leaderboard');
    const leaderboardBody = document.getElementById('leaderboard-body');
    const btnTopLeft = document.getElementById('btn-top-left');

    // Função para atualizar o texto do botão superior esquerdo
    function atualizarBotaoTopLeft() {
      if (!menu.classList.contains('hidden')) {
        // Se estiver no menu principal, sempre mostra Leaderboard
        btnTopLeft.textContent = 'Leaderboard';
        btnTopLeft.onclick = () => {
          menu.classList.add('hidden');
          personagem.classList.add('hidden');
          game.classList.add('hidden');
          creditos.classList.add('hidden');
          resultados.classList.add('hidden');
          leaderboard.classList.remove('hidden');
          atualizarLeaderboard();
        };
      } else if (!personagem.classList.contains('hidden')) {
        // Se estiver na seleção de habilidade, mostra Voltar ao Menu
        btnTopLeft.textContent = 'Voltar ao Menu';
        btnTopLeft.onclick = () => {
          personagem.classList.add('hidden');
          menu.classList.remove('hidden');
          game.classList.add('hidden');
          creditos.classList.add('hidden');
          // reset seleção habilidade visual
          document.querySelectorAll('.personagem-card').forEach(card => {
            card.classList.remove('selecionado');
            card.querySelector('.habilidade-dialogo').textContent = '';
            card.querySelector('.habilidade-dialogo').style.opacity = 0;
            card.querySelector('.btn-continuar').classList.add('hidden');
          });
          mostrarCorredorEsconderSala();
        };
      } else {
        // Em outras telas, mostra Leaderboard
        btnTopLeft.textContent = 'Leaderboard';
        btnTopLeft.onclick = () => {
          menu.classList.add('hidden');
          personagem.classList.add('hidden');
          game.classList.add('hidden');
          creditos.classList.add('hidden');
          resultados.classList.add('hidden');
          leaderboard.classList.remove('hidden');
          atualizarLeaderboard();
        };
      }
    }

    // Função para mostrar corredor e esconder sala
    function mostrarCorredorEsconderSala() {
      document.getElementById('bg-blur').classList.remove('hidden');
      document.getElementById('bg-blur').classList.add('visible');
      document.getElementById('bg-sala').classList.remove('visible');
      document.getElementById('bg-sala').classList.add('hidden');
    }
    // Função para mostrar sala e esconder corredor
    function mostrarSalaEsconderCorredor() {
      document.getElementById('bg-blur').classList.remove('visible');
      document.getElementById('bg-blur').classList.add('hidden');
      document.getElementById('bg-sala').classList.remove('hidden');
      document.getElementById('bg-sala').classList.add('visible');
    }

    // Atualizar o botão quando mudar de tela
    btnJogar.onclick = () => {
      // Solicita tela cheia
      if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
      } else if (document.documentElement.webkitRequestFullscreen) { // Safari
        document.documentElement.webkitRequestFullscreen();
      } else if (document.documentElement.msRequestFullscreen) { // IE11
        document.documentElement.msRequestFullscreen();
      }

      menu.classList.add('hidden');
      document.getElementById('nome-input').classList.remove('hidden');
      personagem.classList.add('hidden');
      game.classList.add('hidden');
      creditos.classList.add('hidden');
      mostrarCorredorEsconderSala();
      atualizarBotaoTopLeft();
    };

    // Event listener para o botão de continuar após digitar o nome
    document.getElementById('btn-continuar-nome').onclick = () => {
      const nameInput = document.getElementById('player-name');
      playerName = nameInput.value.trim();
      
      if (playerName === '') {
        alert('Por favor, digite seu nome!');
        return;
      }
      
      document.getElementById('nome-input').classList.add('hidden');
      personagem.classList.remove('hidden');
      mostrarSalaEsconderCorredor();
      atualizarBotaoTopLeft();
    };

    // Event listener para permitir continuar com Enter no input do nome
    document.getElementById('player-name').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('btn-continuar-nome').click();
      }
    });

    btnVoltarLeaderboard.onclick = () => {
      leaderboard.classList.add('hidden');
      menu.classList.remove('hidden');
      mostrarCorredorEsconderSala();
      atualizarBotaoTopLeft();
    };

    btnCreditos.onclick = () => {
      menu.classList.add('hidden');
      personagem.classList.add('hidden');
      game.classList.add('hidden');
      creditos.classList.remove('hidden');
      mostrarCorredorEsconderSala();
      atualizarBotaoTopLeft();
    };

    btnVoltarCreditos.onclick = () => {
      creditos.classList.add('hidden');
      menu.classList.remove('hidden');
      mostrarCorredorEsconderSala();
      atualizarBotaoTopLeft();
    };

    // Event listener para o botão jogar novamente
    document.getElementById('btn-jogar-novamente').onclick = () => {
      resetarJogo();
      document.getElementById('resultados').classList.add('hidden');
      personagem.classList.remove('hidden');
      // Troca o fundo: esconde corredor, mostra sala
      document.getElementById('bg-blur').classList.remove('visible');
      document.getElementById('bg-blur').classList.add('hidden');
      document.getElementById('bg-sala').classList.remove('hidden');
      document.getElementById('bg-sala').classList.add('visible');
      atualizarBotaoTopLeft();
    };

    // Inicializar o botão
    atualizarBotaoTopLeft();

    // Carregar o leaderboard quando a página carregar
    carregarLeaderboard();

    // Função para resetar o leaderboard
    async function resetarLeaderboard() {
      const senha = prompt('Digite a senha para resetar o leaderboard:');
      if (senha === 'admin123') { // Senha padrão, você pode mudar
        if (confirm('Tem certeza que deseja resetar o leaderboard? Esta ação não pode ser desfeita.')) {
          try {
            await database.ref('leaderboard').set([]);
            melhoresPontuacoes = [];
            atualizarTabelaLeaderboard();
            alert('Leaderboard resetado com sucesso!');
          } catch (error) {
            console.error('Erro ao resetar leaderboard:', error);
            alert('Erro ao resetar leaderboard. Tente novamente.');
          }
        }
      } else if (senha !== null) { // Se o usuário não cancelou o prompt
        alert('Senha incorreta!');
      }
    }

    // Event listener para o botão de reset
    document.getElementById('btn-reset-leaderboard').onclick = resetarLeaderboard;
  </script>
</body>
</html>